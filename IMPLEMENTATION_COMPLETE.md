# ‚úÖ –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê

**–î–∞—Ç–∞:** 2024  
**–°—Ç–∞—Ç—É—Å:** –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã

---

## üéØ –í–´–ü–û–õ–ù–ï–ù–ù–´–ï –ó–ê–î–ê–ß–ò

### ‚úÖ 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –±–ª–æ–∫–∏—Ä—É—é—â–∞—è –æ—à–∏–±–∫–∞ Dp.toPx()
- **–§–∞–π–ª:** `app/src/main/java/com/example/bary/ui/screens/BariCoreScreen.kt`
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ú–µ—Ç–æ–¥ `Dp.toPx()` –Ω–µ –±—ã–ª —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω, —á—Ç–æ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–µ—Ä–µ–≤–∞ –Ω–∞–≤—ã–∫–æ–≤
- **–†–µ—à–µ–Ω–∏–µ:** –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–µ—Ç–æ–¥ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `Density` –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### ‚úÖ 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
- **–§–∞–π–ª:** `app/src/main/java/com/example/bary/di/DatabaseModule.kt`
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è `fallbackToDestructiveMigration()`, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –ø–æ—Ç–µ—Ä–µ –¥–∞–Ω–Ω—ã—Ö
- **–†–µ—à–µ–Ω–∏–µ:** –£–¥–∞–ª–µ–Ω `fallbackToDestructiveMigration()`, –¥–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–∏–≥—Ä–∞—Ü–∏–π
- **–§–∞–π–ª:** `app/src/main/java/com/example/bary/data/local/db/AppDatabase.kt`
- **–†–µ—à–µ–Ω–∏–µ:** –í–∫–ª—é—á–µ–Ω `exportSchema = true` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å—Ö–µ–º—ã
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### ‚úÖ 3. –°–æ–∑–¥–∞–Ω BariTrigger sealed interface
- **–§–∞–π–ª:** `app/src/main/java/com/example/bary/ui/BariTrigger.kt`
- **–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ:** –ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ –¥–ª—è –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### ‚úÖ 4. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø–æ–ª–Ω—ã–π BariViewModel —Å handleTrigger()
- **–§–∞–π–ª:** `app/src/main/java/com/example/bary/ui/BariViewModel.kt`
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
  - –ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ç–æ–¥–∞ `handleTrigger(BariTrigger)`
  - –°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ "–º–æ–∑–≥–∞" —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π UserMode, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è, —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –Ω–∞–≤—ã–∫–æ–≤
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤
  - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ContentRepository –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–æ–≤
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### ‚úÖ 5. –î–æ–±–∞–≤–ª–µ–Ω—ã BariMood –∏ BariPosition
- **–§–∞–π–ª—ã:**
  - `app/src/main/java/com/example/bary/ui/BariMood.kt`
  - `app/src/main/java/com/example/bary/ui/BariPosition.kt`
  - `app/src/main/java/com/example/bary/ui/BariAsset.kt`
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### ‚úÖ 6. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã —Ç—Ä–∏–≥–≥–µ—Ä—ã –≤–æ –≤—Å–µ ViewModels
- **–°–æ–∑–¥–∞–Ω:** `BariEventBus` –¥–ª—è —Å–≤—è–∑–∏ –º–µ–∂–¥—É ViewModels –∏ BariViewModel
- **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤:**
  - `AddTransactionViewModel` - —Ç—Ä–∏–≥–≥–µ—Ä –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
  - `QuizViewModel` - —Ç—Ä–∏–≥–≥–µ—Ä –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∫–≤–∏–∑–∞
  - `AddEditPiggyBankViewModel` - —Ç—Ä–∏–≥–≥–µ—Ä –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–ø–∏–ª–∫–∏
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### ‚úÖ 7. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ "–º–æ–∑–≥–∞" –ë–∞—Ä–∏
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ UserMode –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ unlockedSkills –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã—Ö —Ä–µ–∞–∫—Ü–∏–π
  - –í—ã–±–æ—Ä –¥–∏–∞–ª–æ–≥–æ–≤ –∏–∑ ContentRepository –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤—ã–¥–∞—á–∞ –∫–≤–µ—Å—Ç–æ–≤ –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –ø–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –±–µ–∑ –Ω–∞–≤—ã–∫–∞ budgeting)
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### ‚úÖ 8. –ó–∞–≤–µ—Ä—à–µ–Ω—ã TODO –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö
- **TransactionDetailViewModel:** –î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏—è –∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- **PiggyBankDetailScreen:** –î–æ–±–∞–≤–ª–µ–Ω –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –¥–ª—è –∫–æ–ø–∏–ª–∫–∏
- **LessonDetailScreen:** –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –∫–≤–∏–∑–∞
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ

### ‚úÖ 9. –£–ª—É—á—à–µ–Ω BariView —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø–æ–∑–∏—Ü–∏–π
- **–§–∞–π–ª:** `app/src/main/java/com/example/bary/ui/components/BariView.kt`
- **–£–ª—É—á—à–µ–Ω–∏—è:**
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ BariPosition (BottomEnd, BottomStart, CenterScreen, Hidden, Custom)
  - Crossfade –∞–Ω–∏–º–∞—Ü–∏—è –¥–ª—è —Å–º–µ–Ω—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
  - –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–∑–∏—Ü–∏–π
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

---

## üì¶ –°–û–ó–î–ê–ù–ù–´–ï –§–ê–ô–õ–´

1. `app/src/main/java/com/example/bary/ui/BariTrigger.kt` - Sealed interface –¥–ª—è —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤
2. `app/src/main/java/com/example/bary/ui/BariMood.kt` - Enum –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è –ë–∞—Ä–∏
3. `app/src/main/java/com/example/bary/ui/BariPosition.kt` - Sealed class –¥–ª—è –ø–æ–∑–∏—Ü–∏–π
4. `app/src/main/java/com/example/bary/ui/BariAsset.kt` - Sealed class –¥–ª—è —Ä–µ—Å—É—Ä—Å–æ–≤
5. `app/src/main/java/com/example/bary/ui/BariEventBus.kt` - EventBus –¥–ª—è —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤

---

## üîß –ò–ó–ú–ï–ù–ï–ù–ù–´–ï –§–ê–ô–õ–´

1. `app/src/main/java/com/example/bary/ui/screens/BariCoreScreen.kt` - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω Dp.toPx()
2. `app/src/main/java/com/example/bary/ui/BariViewModel.kt` - –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞
3. `app/src/main/java/com/example/bary/ui/components/BariView.kt` - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–∑–∏—Ü–∏–π
4. `app/src/main/java/com/example/bary/repository/ContentRepository.kt` - –î–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã –¥–ª—è –¥–∏–∞–ª–æ–≥–æ–≤
5. `app/src/main/java/com/example/bary/repository/GamificationRepository.kt` - –î–æ–±–∞–≤–ª–µ–Ω issueQuest()
6. `app/src/main/java/com/example/bary/di/DatabaseModule.kt` - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –º–∏–≥—Ä–∞—Ü–∏–∏
7. `app/src/main/java/com/example/bary/data/local/db/AppDatabase.kt` - –í–∫–ª—é—á–µ–Ω exportSchema
8. `app/src/main/java/com/example/bary/ui/add_transaction/AddTransactionViewModel.kt` - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤
9. `app/src/main/java/com/example/bary/ui/quiz/QuizViewModel.kt` - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤
10. `app/src/main/java/com/example/bary/ui/piggybanks/AddEditPiggyBankViewModel.kt` - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤
11. `app/src/main/java/com/example/bary/ui/transaction_detail/TransactionDetailViewModel.kt` - –ó–∞–≤–µ—Ä—à–µ–Ω TODO
12. `app/src/main/java/com/example/bary/ui/piggybanks/PiggyBankDetailScreen.kt` - –î–æ–±–∞–≤–ª–µ–Ω –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
13. `app/src/main/java/com/example/bary/ui/lessons/LessonDetailScreen.kt` - –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ –∫–≤–∏–∑–∞
14. `app/src/main/java/com/example/bary/MainActivity.kt` - –¢—Ä–∏–≥–≥–µ—Ä –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ

---

## üé® –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø

### BariEventBus Pattern
–°–æ–∑–¥–∞–Ω Singleton `BariEventBus` –¥–ª—è —Å–≤—è–∑–∏ –º–µ–∂–¥—É ViewModels –∏ BariViewModel —á–µ—Ä–µ–∑ SharedFlow. –≠—Ç–æ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –∏–Ω–∂–µ–∫—Ü–∏–∏ Activity-scoped ViewModel –≤ screen-scoped ViewModels.

### –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π ContentRepository
–î–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã:
- `getDialogue(dialogueId, userMode)` - –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞ –ø–æ ID
- `getDialogueByKey(key, userMode)` - –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞ –ø–æ –∫–ª—é—á—É —Å fallback

---

## ‚ö†Ô∏è –í–ê–ñ–ù–´–ï –ó–ê–ú–ï–ß–ê–ù–ò–Ø

### –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
- `fallbackToDestructiveMigration()` —É–¥–∞–ª–µ–Ω
- **–í–ê–ñ–ù–û:** –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ö–µ–º—ã –ë–î –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ `Migration` –æ–±—ä–µ–∫—Ç—ã
- `exportSchema = true` –≤–∫–ª—é—á–µ–Ω –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Ö–µ–º—ã

### BariEventBus
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `extraBufferCapacity = 10` –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–æ—Ç–µ—Ä–∏ —Å–æ–±—ã—Ç–∏–π
- –í—Å–µ ViewModels –º–æ–≥—É—Ç —ç–º–∏—Ç–∏—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä—ã —á–µ—Ä–µ–∑ `bariEventBus.emit(trigger)`
- BariViewModel –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –≤—Å–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã

---

## üìä –ò–¢–û–ì–û–í–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê

- **–°–æ–∑–¥–∞–Ω–æ —Ñ–∞–π–ª–æ–≤:** 5
- **–ò–∑–º–µ–Ω–µ–Ω–æ —Ñ–∞–π–ª–æ–≤:** 14
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫:** 2
- **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π:** 7
- **–ó–∞–≤–µ—Ä—à–µ–Ω–æ TODO:** 3

---

## ‚úÖ –ì–û–¢–û–í–ù–û–°–¢–¨ –ö –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é. –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã, –æ—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
1. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É –¥–µ—Ä–µ–≤–∞ –Ω–∞–≤—ã–∫–æ–≤ (BariCoreScreen)
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö
3. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–æ–±–∞–≤–∏—Ç—å Migration –æ–±—ä–µ–∫—Ç—ã)
4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —ç–∫—Ä–∞–Ω—ã —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –ë–∞—Ä–∏

---

*–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ! üéâ*





